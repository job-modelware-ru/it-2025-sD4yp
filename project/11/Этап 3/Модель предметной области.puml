@startuml
skinparam monochrome true
skinparam linetype ortho
skinparam classAttributeIconSize 0
skinparam classFontSize 14
skinparam classAttributeFontSize 12

title Модель предметной области\nСистема мониторинга арбитража ставок финансирования

class "Пользователь" as User {
  Имя
  Email
  Часовой пояс
  Предпочитаемая валюта (USDT/USD)
  Минимальный порог доходности
  Статус (активен/заблокирован)
}

class "Настройки пользователя" as Profile {
  Избранные торговые пары
  Минимальная ставка финансирования
  Способы уведомлений
}

class "API Ключ" as ApiKey {
  Название
  Права доступа (только чтение)
  Статус (активен/неактивен/заблокирован)
  Дата последнего использования
}

class "Биржа" as Exchange {
  Название
  Статус работы (онлайн/офлайн/обслуживание)
}

class "Торговая пара" as TradingPair {
  Символ (например, BTC/USDT)
  Базовая валюта
  Котируемая валюта
  Минимальный объём сделки
  Максимальное плечо
  Активна (да/нет)
}

class "Ставка финансирования" as CurrentRate {
  Текущая ставка
  Время следующего начисления
  Спотовая цена
  Цена бессрочного контракта
  Спред
  Годовая доходность (APY)
  Объём за 24 часа
}

class "История ставок" as HistoricalData {
  Ставка финансирования
  Спотовая цена
  Цена контракта
  Спред
  Объём торгов
  Период (с — по)
}

class "Оповещение" as Alert {
  Название
  Тип условия (мин. ставка / мин. APY / резкое изменение)
  Пороговое значение
  Способ уведомления (email/push/оба)
  Активно (да/нет)
  Дата последнего срабатывания
}

class "Арбитражная позиция" as Position {
  Размер спотовой позиции
  Размер позиции по контракту
  Цена входа (спот)
  Цена входа (контракт)
  Плечо
  Дата открытия
  Дата закрытия
  Статус (открыта/закрыта/ликвидирована)
  Накопленное финансирование
  Нереализованная прибыль/убыток
  Коэффициент здоровья позиции
}

class "Портфель" as Portfolio {
  Общая прибыль
  Количество позиций
  Средняя доходность
  Уровень риска (низкий/средний/высокий)
}

' === СВЯЗИ ===

User "1" *-- "1" Profile : имеет >
User "1" o-- "0..*" ApiKey : владеет >
User "1" *-- "1" Portfolio : имеет >
User "1" -- "0..*" Alert : настраивает >
User "1" -- "0..*" Position : открывает >

ApiKey "0..*" -- "1" Exchange : для доступа к >

Exchange "1" -- "0..*" TradingPair : предоставляет >

TradingPair "1" -- "0..1" CurrentRate : имеет текущую >
TradingPair "1" -- "0..*" HistoricalData : имеет историю >

Alert "0..*" -- "0..1" TradingPair : отслеживает >

Position "0..*" -- "1" TradingPair : по паре >
Portfolio "1" o-- "0..*" Position : содержит >

' === ПРИМЕЧАНИЯ ===

note top of User
  <b>Роль:</b> Трейдер
  <b>Регистрация:</b> по email с подтверждением
end note

note right of ApiKey
  <b>Ограничение:</b> только права на чтение
  <b>Безопасность:</b> ключи хранятся зашифрованными
end note

note left of CurrentRate
  <b>Обновление:</b> каждые 30 секунд
  <b>Формула APY:</b>
  ставка × 3 × 365 × 100%
end note

note bottom of Alert
  <b>Проверка условий:</b> каждые 5 минут
end note

note right of Position
  <b>Коэффициент здоровья</b> показывает
  расстояние до ликвидации
end note

@enduml