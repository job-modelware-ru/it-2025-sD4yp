@startuml
title Диаграмма деятельности: Создание группы (Строгая логика)
start

:Хост авторизован;
:Нажать "Создать группу";

partition "Настройка" {
  :Ввод названия и типа приватности;
  :Генерация ID группы;
}

partition "Проверка интеграций" {
  ' Метка для визуального возврата (опционально, PlantUML сам соединит)
  
  if (Есть подключенные сервисы?) then (нет)
    :Уведомление: "Нет доступных сервисов";
    
    if (Подключить сервис сейчас?) then (нет)
      :Ошибка: Группа не может функционировать\nбез источника музыки;
      #pink:Статус создания: FAILED;
      stop
    else (да)
      partition "Привязка аккаунта" {
        :Выбор провайдера;
        :OAuth и сохранение токена;
      }
      ' Стрелка автоматически пойдет вниз к точке слияния
    endif
    
  else (да)
    ' Просто проходим дальше
  endif
  
  ' === ТОЧКА СЛИЯНИЯ ===
  ' Сюда попадаем либо сразу (если было да), 
  ' либо после успешной привязки
  
  :Отображение списка доступных сервисов;
  :Хост выбирает сервис для этой группы;
}

partition "Финализация" {
  :Привязка сервиса к группе;
  :Создание плейлиста;
  :Генерация QR-кода;
  #lightgreen:Статус: SUCCESS;
}

stop
@enduml