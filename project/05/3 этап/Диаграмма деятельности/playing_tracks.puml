@startuml
title Диаграмма деятельности: Цикличное воспроизведение (с обработкой ошибок)

|#AliceBlue|Хост|
start
:Нажимает кнопку "Play";

|#Ivory|Система|
:Получить текущий плейлист;

if (Плейлист пуст?) then (да)
  :Уведомление "Пусто";
  stop
else (нет)
  :Установить индекс на 1-й трек;
endif

' === НАЧАЛО ЦИКЛА ===
repeat
  |Система|
  :Получить данные текущего трека;
  :Сформировать URL и параметры;
  :Отправить запрос на воспроизведение;

  |#MistyRose|Внешний провайдер|
  :Попытка запуска контента;

  ' Ветвление: Ошибка или Успех
  if (Ошибка воспроизведения?) then (да)
    :Вернуть код ошибки;
    
    |Система|
    :Показать уведомление:\n"Ошибка воспроизведения (Skipped)";
    note right
      Сразу переходим к проверке
      следующего трека
    end note
    
  else (нет)
    |Внешний провайдер|
    :Открыть плеер / Начать поток;
    
    |Система|
    :Запустить таймер ожидания;
    note right
      Ждем длительность трека
      (Delta time)
    end note
    
    :Таймер истек (Трек закончился);
    :Закрыть вкладку/сессию провайдера;
  endif

  |Система|
  :Проверить наличие следующего трека;

' Если трек есть - идем в начало (repeat), если нет - выходим
repeat while (Есть следующий трек?) is (да)
-> нет;

:Показать сообщение "Плейлист завершен";
stop
@enduml