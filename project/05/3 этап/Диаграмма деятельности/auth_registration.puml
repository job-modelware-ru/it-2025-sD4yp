@startuml
title Диаграмма деятельности: Регистрация и начальная настройка пользователя
start

:Пользователь открывает приложение;
if (Уже авторизован?) then (да)
  :Перенаправление в личный кабинет;
  stop
else (нет)
  :Предлагается вход/регистрация;
  if (Выбор: "Войти") then (войти)
    partition "Вход в систему" {
      :Ввод email/пароля;
      :Проверка учетных данных;
      if (Данные верны?) then (да)
        :Успешный вход;
      else (нет)
        :Ошибка: неверные данные;
        stop
      endif
    }
  else (зарегистрироваться)
    partition "Регистрация" {
      :Ввод email;
      :Проверка на уникальность;
      if (Email свободен?) then (да)
        :Ввод пароля;
        :Создание учетной записи;
        :Отправка подтверждения;
        :Пользователь подтверждает email;
        :Учетная запись активирована;
      else (нет)
        :Ошибка: email уже используется;
        stop
      endif
    }
  endif
endif

partition "Начальная настройка" {
  :Предложить подключить стриминговый сервис;
  if (Пользователь согласен?) then (да)
    :Выбор сервиса (Spotify/YouTube/Яндекс);
    :OAuth авторизация в выбранном сервисе;
    :Система сохраняет токен доступа;
    note right: Токен используется для поиска\nи экспорта плейлистов
  else (нет)
    :Пропуск шага;
    note right: Можно будет подключить позже\nв настройках профиля
  endif
}

:Пользователь перенаправлен в личный кабинет;
stop

@enduml